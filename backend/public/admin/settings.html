<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×”×’×“×¨×•×ª ××ª×¨ - ××¢×¨×›×ª ×©×•×‘×¨×™×</title>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Assistant', sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            color: white;
        }
        .navbar {
            background: rgba(0,0,0,0.3);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .navbar-brand img {
            width: 45px;
            height: 45px;
            border-radius: 50%;
        }
        .navbar-brand h1 {
            font-size: 1.3rem;
            color: #FFD700;
        }
        .navbar-user {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .user-name { color: #ccc; }
        .nav-links {
            display: flex;
            gap: 15px;
        }
        .nav-link {
            color: #ccc;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.3s;
        }
        .nav-link:hover, .nav-link.active {
            background: rgba(255,215,0,0.2);
            color: #FFD700;
        }
        .btn-logout {
            background: rgba(220,53,69,0.3);
            color: #ff6b6b;
        }
        .btn-logout:hover { background: rgba(220,53,69,0.5); }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px;
        }
        .section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .section-header h2 { color: #FFD700; font-size: 1.4rem; }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #1a1a1a;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(255,215,0,0.4); }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .btn-danger { background: rgba(220,53,69,0.8); color: #fff; }
        .btn-small { padding: 8px 14px; font-size: 0.9rem; }
        
        /* Carousel Images */
        .images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        .image-card {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            aspect-ratio: 16/9;
            background: rgba(0,0,0,0.3);
        }
        .image-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .image-card .actions {
            position: absolute;
            top: 8px;
            left: 8px;
            display: flex;
            gap: 5px;
        }
        .image-card .btn-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.7);
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }
        .image-card .btn-icon:hover { background: rgba(0,0,0,0.9); }
        .image-card .btn-icon.delete:hover { background: rgba(220,53,69,0.9); }
        
        /* FAQ Items */
        .faq-list { display: flex; flex-direction: column; gap: 15px; }
        .faq-item {
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .faq-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 12px;
        }
        .faq-question {
            font-weight: 600;
            color: #FFD700;
            font-size: 1.1rem;
        }
        .faq-answer { color: #ccc; line-height: 1.6; }
        .faq-actions { display: flex; gap: 8px; flex-shrink: 0; }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        .modal {
            background: #1a1a2e;
            border-radius: 20px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .modal-header h3 { font-size: 1.4rem; color: #FFD700; }
        .close-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: #fff;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
        }
        .modal-body { padding: 25px; }
        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #ddd;
            font-weight: 500;
        }
        .form-input, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            color: #fff;
            font-size: 1rem;
        }
        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #FFD700;
        }
        .form-textarea { min-height: 120px; resize: vertical; }
        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        .hidden { display: none !important; }
        .saving { opacity: 0.6; pointer-events: none; }
        .save-indicator {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #22c55e;
            color: #fff;
            padding: 12px 25px;
            border-radius: 30px;
            font-weight: 600;
            box-shadow: 0 5px 20px rgba(34,197,94,0.4);
            transition: opacity 0.3s;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-brand">
            <img src="https://qtrypzzcjebvfcihiynt.supabase.co/storage/v1/object/public/base44-prod/public/e8802db8b_.jpg" alt="Logo">
            <h1>××¢×¨×›×ª × ×™×”×•×œ ×©×•×‘×¨×™×</h1>
        </div>
        <div class="navbar-user">
            <div class="nav-links">
                <a href="/admin/" class="nav-link">×©×•×‘×¨×™×</a>
                <a href="/admin/leads" class="nav-link">×œ×™×“×™×</a>
                <a href="/admin/products" class="nav-link">××•×¦×¨×™×</a>
                <a href="/admin/settings" class="nav-link active">×”×’×“×¨×•×ª</a>
                <a href="/admin/users" class="nav-link" id="usersLink" style="display:none">××©×ª××©×™×</a>
            </div>
            <span class="user-name" id="userName"></span>
            <button class="btn btn-logout" onclick="logout()">×™×¦×™××”</button>
        </div>
    </nav>

    <div class="container">
        <!-- Carousel Images Section -->
        <div class="section">
            <div class="section-header">
                <h2>ğŸ–¼ï¸ ×ª××•× ×•×ª ×§×¨×•×¡×œ×”</h2>
                <button class="btn btn-primary btn-small" onclick="openImageModal()">+ ×”×•×¡×£ ×ª××•× ×”</button>
            </div>
            <div class="images-grid" id="imagesGrid">
                <p style="color:#888">×˜×•×¢×Ÿ...</p>
            </div>
        </div>

        <!-- FAQ Section -->
        <div class="section">
            <div class="section-header">
                <h2>â“ ×©××œ×•×ª ×•×ª×©×•×‘×•×ª</h2>
                <button class="btn btn-primary btn-small" onclick="openFaqModal()">+ ×”×•×¡×£ ×©××œ×”</button>
            </div>
            <div class="faq-list" id="faqList">
                <p style="color:#888">×˜×•×¢×Ÿ...</p>
            </div>
        </div>

        <!-- Default Greeting Section -->
        <div class="section">
            <div class="section-header">
                <h2>ğŸ’¬ ×‘×¨×›×ª ×‘×¨×™×¨×ª ××—×“×œ</h2>
                <button class="btn btn-primary btn-small" onclick="saveDefaultGreeting()">×©××•×¨</button>
            </div>
            <p style="color:#888; margin-bottom: 15px;">×”×‘×¨×›×” ×©×ª×•×¤×™×¢ ×›×‘×¨×™×¨×ª ××—×“×œ ×‘×˜×•×¤×¡ ×”×¨×›×™×©×” (×”×™×× ×¢×• ×××™××•×’'×™×)</p>
            <textarea class="form-textarea" id="defaultGreeting" style="min-height: 150px;" placeholder="×”×–×™× ×• ×‘×¨×›×ª ×‘×¨×™×¨×ª ××—×“×œ..."></textarea>
        </div>

        <!-- Admin Notification Email Section -->
        <div class="section">
            <div class="section-header">
                <h2>ğŸ“§ ××™×™×œ ×”×ª×¨××•×ª ×œ×× ×”×œ</h2>
                <button class="btn btn-primary btn-small" onclick="saveAdminEmail()">×©××•×¨</button>
            </div>
            <p style="color:#888; margin-bottom: 15px;">×›×ª×•×‘×ª ×”××™×™×œ ×©×ª×§×‘×œ ×”×ª×¨××” ×¢×œ ×›×œ ×¨×›×™×©×” ×—×“×©×”</p>
            <input type="email" class="form-input" id="adminNotificationEmail" placeholder="example@email.com" style="max-width:400px">
        </div>
    </div>

    <!-- Add Image Modal -->
    <div class="modal-overlay hidden" id="imageModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="imageModalTitle">×”×•×¡×¤×ª ×ª××•× ×”</h3>
                <button class="close-btn" onclick="closeImageModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>×§×™×©×•×¨ ×œ×ª××•× ×” *</label>
                    <input type="url" class="form-input" id="imageUrl" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label>×ª×™××•×¨ (alt)</label>
                    <input type="text" class="form-input" id="imageAlt" placeholder="×ª×™××•×¨ ×”×ª××•× ×”">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeImageModal()">×‘×™×˜×•×œ</button>
                <button class="btn btn-primary" onclick="saveImage()">×©××•×¨</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit FAQ Modal -->
    <div class="modal-overlay hidden" id="faqModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="faqModalTitle">×”×•×¡×¤×ª ×©××œ×”</h3>
                <button class="close-btn" onclick="closeFaqModal()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="faqIndex">
                <div class="form-group">
                    <label>×©××œ×” *</label>
                    <input type="text" class="form-input" id="faqQuestion" placeholder="××”×™ ×”×©××œ×”?">
                </div>
                <div class="form-group">
                    <label>×ª×©×•×‘×” *</label>
                    <textarea class="form-textarea" id="faqAnswer" placeholder="×”×ª×©×•×‘×” ×œ×©××œ×”..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeFaqModal()">×‘×™×˜×•×œ</button>
                <button class="btn btn-primary" onclick="saveFaq()">×©××•×¨</button>
            </div>
        </div>
    </div>

    <!-- Save Indicator -->
    <div class="save-indicator hidden" id="saveIndicator">âœ“ × ×©××¨ ×‘×”×¦×œ×—×”</div>

    <script>
        const API = '/api';
        let carouselImages = [];
        let faqItems = [];
        let defaultGreeting = '';

        // Check auth
        checkAuth();

        async function checkAuth() {
            try {
                const res = await fetch(`${API}/auth/me`, { credentials: 'include' });
                if (!res.ok) {
                    window.location.href = '/admin/login';
                    return;
                }
                const data = await res.json();
                document.getElementById('userName').textContent = data.user.name || data.user.email;
                if (data.user.role === 'admin') {
                    document.getElementById('usersLink').style.display = 'block';
                }
                loadSettings();
            } catch {
                window.location.href = '/admin/login';
            }
        }

        async function loadSettings() {
            try {
                const res = await fetch(`${API}/settings`, { credentials: 'include' });
                const settings = await res.json();
                
                carouselImages = settings.carousel_images || [];
                faqItems = settings.faq_items || [];
                defaultGreeting = settings.default_greeting || `×‘××”×‘×”, ××›×œ ×”×œ×‘

×©×™×”×™×” ×¨×’×¢ ×©×œ ×¤×™× ×•×§, ×”×¤×¡×§×” ×©×œ ×©×œ×•×•×”,
××• × ×’×™×¢×” ×§×˜× ×” ×©×œ ×™×¨×•×§ ×‘×¢×™× ×™×™×

××§×•×•×™× ×©×ª×”× ×• ××”×©×•×‘×¨ ×”×–×” ×‘×“×™×•×§ ×›××• ×©×—×©×‘× ×• ×¢×œ×™×›× ×›×©×‘×—×¨× ×• ××•×ª×•`;
                
                document.getElementById('defaultGreeting').value = defaultGreeting;
                document.getElementById('adminNotificationEmail').value = settings.admin_notification_email || '';
                renderImages();
                renderFaq();
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }
        
        async function saveDefaultGreeting() {
            const greeting = document.getElementById('defaultGreeting').value.trim();
            if (!greeting) {
                alert('× × ×œ×”×–×™×Ÿ ×‘×¨×›×”');
                return;
            }
            
            try {
                await fetch(`${API}/settings/default_greeting`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ value: greeting })
                });
                showSaveIndicator();
            } catch (error) {
                alert('×©×’×™××” ×‘×©××™×¨×”');
            }
        }
        
        async function saveAdminEmail() {
            const email = document.getElementById('adminNotificationEmail').value.trim();
            if (!email) {
                alert('× × ×œ×”×–×™×Ÿ ××™×™×œ');
                return;
            }
            
            try {
                await fetch(`${API}/settings/admin_notification_email`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ value: email })
                });
                showSaveIndicator();
            } catch (error) {
                alert('×©×’×™××” ×‘×©××™×¨×”');
            }
        }

        // Carousel Images
        function renderImages() {
            const grid = document.getElementById('imagesGrid');
            if (carouselImages.length === 0) {
                grid.innerHTML = '<p style="color:#888">××™×Ÿ ×ª××•× ×•×ª. ×œ×—×¥ ×¢×œ "×”×•×¡×£ ×ª××•× ×”" ×œ×”×•×¡×¤×ª ×ª××•× ×” ×—×“×©×”.</p>';
                return;
            }
            
            grid.innerHTML = carouselImages.map((img, i) => `
                <div class="image-card">
                    <img src="${img.url}" alt="${img.alt || ''}" onerror="this.src='https://via.placeholder.com/400x225?text=Error'">
                    <div class="actions">
                        <button class="btn-icon delete" onclick="deleteImage(${i})" title="××—×§">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');
        }

        function openImageModal() {
            document.getElementById('imageModalTitle').textContent = '×”×•×¡×¤×ª ×ª××•× ×”';
            document.getElementById('imageUrl').value = '';
            document.getElementById('imageAlt').value = '';
            document.getElementById('imageModal').classList.remove('hidden');
        }

        function closeImageModal() {
            document.getElementById('imageModal').classList.add('hidden');
        }

        async function saveImage() {
            const url = document.getElementById('imageUrl').value.trim();
            const alt = document.getElementById('imageAlt').value.trim();
            
            if (!url) {
                alert('× × ×œ×”×–×™×Ÿ ×§×™×©×•×¨ ×œ×ª××•× ×”');
                return;
            }
            
            carouselImages.push({ url, alt });
            await saveCarouselImages();
            closeImageModal();
            renderImages();
        }

        async function deleteImage(index) {
            if (!confirm('×œ××—×•×§ ××ª ×”×ª××•× ×”?')) return;
            carouselImages.splice(index, 1);
            await saveCarouselImages();
            renderImages();
        }

        async function saveCarouselImages() {
            try {
                await fetch(`${API}/settings/carousel_images`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ value: carouselImages })
                });
                showSaveIndicator();
            } catch (error) {
                alert('×©×’×™××” ×‘×©××™×¨×”');
            }
        }

        // FAQ Items
        function renderFaq() {
            const list = document.getElementById('faqList');
            if (faqItems.length === 0) {
                list.innerHTML = '<p style="color:#888">××™×Ÿ ×©××œ×•×ª. ×œ×—×¥ ×¢×œ "×”×•×¡×£ ×©××œ×”" ×œ×”×•×¡×¤×ª ×©××œ×” ×—×“×©×”.</p>';
                return;
            }
            
            list.innerHTML = faqItems.map((item, i) => `
                <div class="faq-item">
                    <div class="faq-item-header">
                        <div class="faq-question">${item.question}</div>
                        <div class="faq-actions">
                            <button class="btn btn-secondary btn-small" onclick="editFaq(${i})">×¢×¨×™×›×”</button>
                            <button class="btn btn-danger btn-small" onclick="deleteFaq(${i})">××—×™×§×”</button>
                        </div>
                    </div>
                    <div class="faq-answer">${item.answer}</div>
                </div>
            `).join('');
        }

        function openFaqModal() {
            document.getElementById('faqModalTitle').textContent = '×”×•×¡×¤×ª ×©××œ×”';
            document.getElementById('faqIndex').value = '';
            document.getElementById('faqQuestion').value = '';
            document.getElementById('faqAnswer').value = '';
            document.getElementById('faqModal').classList.remove('hidden');
        }

        function editFaq(index) {
            const item = faqItems[index];
            document.getElementById('faqModalTitle').textContent = '×¢×¨×™×›×ª ×©××œ×”';
            document.getElementById('faqIndex').value = index;
            document.getElementById('faqQuestion').value = item.question;
            document.getElementById('faqAnswer').value = item.answer;
            document.getElementById('faqModal').classList.remove('hidden');
        }

        function closeFaqModal() {
            document.getElementById('faqModal').classList.add('hidden');
        }

        async function saveFaq() {
            const index = document.getElementById('faqIndex').value;
            const question = document.getElementById('faqQuestion').value.trim();
            const answer = document.getElementById('faqAnswer').value.trim();
            
            if (!question || !answer) {
                alert('× × ×œ××œ× ×©××œ×” ×•×ª×©×•×‘×”');
                return;
            }
            
            if (index !== '') {
                faqItems[parseInt(index)] = { question, answer };
            } else {
                faqItems.push({ question, answer });
            }
            
            await saveFaqItems();
            closeFaqModal();
            renderFaq();
        }

        async function deleteFaq(index) {
            if (!confirm('×œ××—×•×§ ××ª ×”×©××œ×”?')) return;
            faqItems.splice(index, 1);
            await saveFaqItems();
            renderFaq();
        }

        async function saveFaqItems() {
            try {
                await fetch(`${API}/settings/faq_items`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ value: faqItems })
                });
                showSaveIndicator();
            } catch (error) {
                alert('×©×’×™××” ×‘×©××™×¨×”');
            }
        }

        function showSaveIndicator() {
            const indicator = document.getElementById('saveIndicator');
            indicator.classList.remove('hidden');
            setTimeout(() => indicator.classList.add('hidden'), 2000);
        }

        function logout() {
            fetch(`${API}/auth/logout`, { method: 'POST', credentials: 'include' })
                .finally(() => window.location.href = '/admin/login');
        }
    </script>
</body>
</html>
