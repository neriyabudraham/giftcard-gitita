-- ייבוא נתונים מקובץ Card_export.csv
-- לקוחות (אלה שיש להם voucher_download_link או whatsapp_sent=true)
-- מתעניינים (pending - אלה שלא השלימו תהליך)

-- לקוחות (status = completed)
INSERT INTO purchases (voucher_number, amount, buyer_first_name, buyer_last_name, buyer_phone, buyer_email, recipient_first_name, recipient_last_name, recipient_phone, greeting, status, created_at)
SELECT * FROM (VALUES
    ('6307832152026', 95, 'נתנאל', 'בר', '0556822072', 'netanelbar9@gmail.com', 'ברכה ', '.', '0547672678', 'ברכה, בהערכה והוקרה על פועלך לטובת הצלחת אירועי חנוכה ופעילות הבית ספר שדה. עכשיו קחי זמן בנחת עם יאיר ב"שפת המדבר". יאיר', 'completed', '2025-12-29'::timestamp),
    ('6728623515804', 95, 'נתנאל', 'בר', '0556822072', 'netanelbar9@gmail.com', 'עומרי', '.', '0547672678', 'עומרי, בהערכה והוקרה על פועלך לטובת הצלחת אירועי חנוכה ופעילות הבית ספר שדה. עכשיו קח זמן בנחת עם לינוי ב"שפת המדבר". יאיר', 'completed', '2025-12-29'::timestamp),
    ('3630031435308', 95, 'נתנאל', 'בר', '0556822072', 'netanelbar9@gmail.com', 'צבי יהודה', '.', '0547672678', 'צבי יהודה, בהערכה והוקרה על פועלך לטובת הצלחת אירועי חנוכה ופעילות הבית ספר שדה. עכשיו קח זמן בנחת עם הדס ב"שפת המדבר". יאיר', 'completed', '2025-12-29'::timestamp),
    ('2662971722752', 95, 'יאיר', 'אליאב', '0547672678', 'netanelbar9@gmail.com', 'אורלי', '.', '0547672678', 'אורלי, בהערכה והוקרה על פועלך לטובת הצלחת אירועי חנוכה ופעילות הבית ספר שדה. עכשיו קחי זמן בנחת עם ניסים ב"שפת המדבר". יאיר', 'completed', '2025-12-29'::timestamp),
    ('3944767250486', 95, 'נתנאל ', 'בר', '0556822072', 'netanelbar9@gmail.com', 'תהל', '.', '0547672678', 'תהל, בהערכה והוקרה על פועלך לטובת הצלחת אירועי חנוכה ופעילות הבית ספר שדה. עכשיו קחי זמן בנחת עם מתן ב"שפת המדבר". יאיר', 'completed', '2025-12-29'::timestamp),
    ('7686250945645', 188, 'מתן', 'אריאל', '0532255771', 'matanariel99@gmail.com', 'אורי', 'נעם', '0507405556', 'אורי היקר, איזה אח אתה! יודע שלא עזרת לי על מנת לקבל ממני משהו.. אבל בדיוק בגלל זה אני אוהב אותך אחי ורוצה לפנק אתכם במשהו סמלי', 'completed', '2025-12-29'::timestamp),
    ('7091550698156', 300, 'מלכה', 'פרבר', '0522892674', 'malcusia98@gmail.com', 'אשר והדר ', 'פרבר', '0584536460', 'אשר והדרי האהובים, כל כך מזמן רצינו לתת לכם משהו מאיתנו האחים', 'completed', '2025-12-24'::timestamp),
    ('1005697199675', 300, 'רחלי', 'פליקס', '0529571124', 'racheli.greenvald@gmail.com', 'צופיה ושגיב ', 'ליכטמן', '0509947573', 'צופיה המיוחדת (ושגיב שתומך ומוותר מאחורה..) תודה ענקית על השקעת שעות רבות רבות למען ההיסטוריה המשפחתית', 'completed', '2025-12-20'::timestamp),
    ('5809223677885', 100, 'הדס', 'מועלם', '0528888021', 'hadasili@gmail.com', 'רחלי ואילון ', 'וייס', '0547878880', 'רחלי ואילון המדהימים!! תודה ענקית על פתיחת הבית והלב אתם אנשים מלאים אור וענווה', 'completed', '2025-12-18'::timestamp),
    ('6668750634428', 100, 'נתנאל ', 'בר', '0556822072', 'netanelbar9@gmail.com', 'ספיר', '.', '0542411961', 'לינוי וצור והקטנטנים תתפנקו לכם', 'completed', '2025-12-17'::timestamp),
    ('2502793184742', 600, 'יסכה', 'אהרוני', '0586484663', 'officemevot@gmail.com', 'יואל ', 'שילה', '0586484663', 'יואל היקר! תודה גדולה על עשייתך הברוכה במשך שלוש השנים האחרונות', 'completed', '2025-12-09'::timestamp),
    ('0646815785497', 95, 'הראל ', 'לאופר', '0552526723', 'rllaufer1@gmail.com', 'יונתן ומרים ', 'לאופר', '0552668228', 'אבא ואמא יום נישואים שמח בתיאבון תיהנו אוהבים הילדים', 'completed', '2025-12-08'::timestamp),
    ('5839268666087', 188, 'אביה ', 'קנאפו', '0533320410', 'Aviyaatiya123@gmail.com', 'יובל ', 'גולדיס ', '0556644305', 'ליובל ושריה באהבה, מהשכנים בחושן', 'completed', '2025-12-07'::timestamp),
    ('6669968033698', 600, 'מבואות יריחו', 'אגודה שיתופית', '0586484663', 'officemevot@gmail.com', 'יואל', 'שילה', '0587929611', 'באהבה, מכל הלב שיהיה רגע של פינוק', 'completed', '2025-12-07'::timestamp),
    ('1629068729014', 100, 'רות', 'קופלוביץ', '0546418288', 'Rutkoplo@gmail.com', 'דיני', 'שטרנברג', '0523871479', 'דיני אהובה, שיהיה רגע של פינוק. קהילת מחולה', 'completed', '2025-11-20'::timestamp),
    ('2044412381335', 100, 'רות', 'קופלוביץ', '0546418288', 'Rutkoplo@gmail.com', 'אופירה', 'זק', '0522224267', 'אופירה באהבה, שיהיה רגע של פינוק. קהילת מחולה', 'completed', '2025-11-20'::timestamp),
    ('5448071447419', 100, 'מאור שרה', 'אלגזי', '0584478825', 'maorsaranis@gmail.com', 'לאבא ואמא', 'האהובים', '0584478826', 'בהודיה גדולה על שזכינו לינוק מכם, לצמוח מתוככם ולגדול בזכותכם. אוהבים מאוד! משפחת אלגזי', 'completed', '2025-11-10'::timestamp),
    ('5285465991040', 100, 'נינה ', 'סולימני', '0525580536', 'ninasulimani@gmail.com', 'אתי', 'גולדשטיין', '0525580536', 'אתי היקרה, יום הולדת שמח! מאחלים לך המון אושר, בריאות ואהבה. ילדי והורי גן צאלון', 'completed', '2025-10-22'::timestamp),
    ('8771507037024', 100, 'אליאור', 'מרטן', '0509223229', 'elior125@gmail.com', 'טליה', 'דיקשטיין', '0527710204', 'באהבה, מכל הלב שיהיה רגע של פינוק', 'completed', '2025-09-27'::timestamp),
    ('7038706477157', 188, 'אליאור', 'מרטן', '0509223229', 'elior125@gmail.com', 'מרים ', 'גרינברג', '0508740143', 'באהבה, מכל הלב שיהיה רגע של פינוק', 'completed', '2025-09-27'::timestamp),
    ('6478336928706', 100, 'אליאור', 'מרטן', '0509223229', 'elior125@gmail.com', 'ישראל ', 'שטרית', '0502210503', 'באהבה, מכל הלב שיהיה רגע של פינוק', 'completed', '2025-09-27'::timestamp),
    ('6665083294294', 100, 'אליאור', 'מרטן', '0509223229', 'elior125@gmail.com', 'דושי', 'טמיר', '0508740143', 'מקווים שתהני מהשובר הזה ושתהיה שנה טובה ומתוקה! גנון שקד התשפו', 'completed', '2025-09-21'::timestamp),
    ('9485317158423', 100, 'אליאור', 'מרטן', '0509223229', 'elior125@gmail.com', 'תחיה', 'כלף', '0508740143', 'מקווים שתהני מהשובר הזה ושתהיה שנה טובה ומתוקה! גנון שקד התשפו', 'completed', '2025-09-21'::timestamp),
    ('6624316757746', 100, 'אליאור', 'מרטן', '0509223229', 'elior125@gmail.com', 'חנה ', 'בן לולו', '0556668424', 'מקווים שתהני מהשובר הזה ושתהיה שנה טובה ומתוקה! גנון שקד התשפו', 'completed', '2025-09-21'::timestamp),
    ('7367766043598', 100, 'אליאור', 'מרטן', '0509223229', 'elior125@gmail.com', 'הודיה', 'אחדות', '0585586665', 'מקווים שתהני מהשובר הזה ושתהיה שנה טובה ומתוקה! גנון שקד התשפו', 'completed', '2025-09-21'::timestamp),
    ('1478454961886', 100, 'אליאור', 'מרטן', '0509223229', 'elior125@gmail.com', 'גפן', 'כהן', '0586277433', 'מקווים שתהני מהשובר הזה ושתהיה שנה טובה ומתוקה! זכינו בך', 'completed', '2025-09-21'::timestamp)
) AS t(voucher_number, amount, buyer_first_name, buyer_last_name, buyer_phone, buyer_email, recipient_first_name, recipient_last_name, recipient_phone, greeting, status, created_at)
WHERE NOT EXISTS (SELECT 1 FROM purchases p WHERE p.voucher_number = t.voucher_number);

-- מתעניינים (status = pending)
INSERT INTO purchases (voucher_number, amount, buyer_first_name, buyer_last_name, buyer_phone, buyer_email, recipient_first_name, recipient_last_name, recipient_phone, greeting, status, created_at)
SELECT * FROM (VALUES
    ('0487287984250', 100, 'בת-ציון', 'סלמון', '0542192709', 'batzionf@gmail.com', 'טליה ויפתח ', 'דויטש', '0547882905', 'טליה ויפתח אהובים שלנו, איזה כיף! אתם הגמדים הענקיים שלנו!!!', 'pending', '2026-02-26'::timestamp),
    ('2065444362962', 188, 'אמונה', 'יעקבי', '0523115380', 'emuna2626@gmail.com', 'זוהר ורעות', 'סבח', '0523115380', 'למשפחת סבח היקרה! מעריכים ומוקירים את הרגעים הטובים', 'pending', '2026-02-23'::timestamp),
    ('0160842332489', 600, 'נריה', 'אבודרהם', '0584254229', 'neriy.nisim@gmail.com', 'נריה', 'אבודרהם', '0584254229', 'באהבה, מכל הלב שיהיה רגע של פינוק', 'pending', '2026-02-23'::timestamp),
    ('2205225779642', 300, 'נריה', 'אבודרהם', '0584254229', 'neriy.nisim@gmail.com', 'נריה', 'אבודרהם', '0584254229', 'באהבה, מכל הלב שיהיה רגע של פינוק', 'pending', '2026-02-23'::timestamp),
    ('7484863879815', 100, 'נריה', 'אבודרהם', '0584254229', 'neriy.nisim@gmail.com', 'נריה', 'אבודרהם', '0584254229', 'באהבה, מכל הלב שיהיה רגע של פינוק', 'pending', '2026-02-23'::timestamp),
    ('6900601011098', 188, 'נריה', 'אבודרהם', '0584254229', 'neriy.nisim@gmail.com', 'נריה', 'אבודרהם', '0584254229', 'באהבה, מכל הלב שיהיה רגע של פינוק', 'pending', '2026-02-23'::timestamp),
    ('6986300142020', 95, 'נריה', 'אבודרהם', '0584254229', 'neriy.nisim@gmail.com', 'נריה', 'אבודרהם', '0584254229', 'באהבה, מכל הלב שיהיה רגע של פינוק', 'pending', '2026-02-23'::timestamp),
    ('6660569646213', 100, 'שרה', 'קשתיאל', '0543978374', 'arvajr48@gmail.com', 'שבות עמי', 'מובשוביץ', '0546603122', 'בהערכה גדולה', 'pending', '2026-02-03'::timestamp),
    ('4827282517460', 100, 'שרה', 'קשתיאל', '0543978374', 'arvajr48@gmail.com', 'שבות עמי', 'מובשוביץ', '0546603122', 'בהערכה גדולה', 'pending', '2026-02-03'::timestamp),
    ('5851079381055', 95, 'נתנאל', 'בר', '0556822072', 'netanelbar9@gmail.com', 'ברכה ', '.', '0547672678', 'ברכה, בהערכה והוקרה על פועלך לטובת הצלחת אירועי חנוכה', 'pending', '2025-12-29'::timestamp),
    ('4901091412928', 95, 'יאיר', 'אליאב ', '0547672678', 'yaireliav@gmail.com', 'תהל', 'נמיר', '0547672678', 'תודה רבה על העזרה, על הגדלת הראש ועל השותפות. מעריך מאוד, יאיר.', 'pending', '2025-12-26'::timestamp),
    ('1627288119850', 95, 'יאיר', 'אליאב ', '0547672678', 'yaireliav@gmail.com', 'תהל', 'נמיר', '0547672678', 'באהבה, מכל הלב שיהיה רגע של פינוק', 'pending', '2025-12-26'::timestamp),
    ('8838508428410', 300, 'מלכה', 'פרבר', '0522892674', 'malcusia98@gmail.com', 'אשר והדר ', 'פרבר', '0584536460', 'אשר והדרי האהובים, כל כך מזמן רצינו לתת לכם משהו מאיתנו האחים', 'pending', '2025-12-24'::timestamp)
) AS t(voucher_number, amount, buyer_first_name, buyer_last_name, buyer_phone, buyer_email, recipient_first_name, recipient_last_name, recipient_phone, greeting, status, created_at)
WHERE NOT EXISTS (SELECT 1 FROM purchases p WHERE p.voucher_number = t.voucher_number);

-- עדכון סטטיסטיקות
SELECT 
    COUNT(*) FILTER (WHERE status = 'completed') as total_customers,
    COUNT(*) FILTER (WHERE status = 'pending') as total_leads,
    COUNT(*) as total_records
FROM purchases;
